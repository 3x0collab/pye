{% extends 'layouts/base.html' %}
{% load static %}
{% block title %} UI Tables {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}
{% load widget_tweaks %}
{% block content %}
     <div class="banner-area text-combo top-pad-90 rectangular-shape bg-light-gradient ">
        <div class="item">
            <div class="box-table">
                <div class="box-cell">
                    <div class="containedr mx-4 ">
                        <div class="row card px-5" style="display: flex; align-items: flex-start; flex-direction: row; width:100%;">
                                <div class=" " style="width: 80%;" >
                                    <h3 class="wow fadeInDown mt-4 pt-3" data-wow-duration="1s" style="font-size:30px; font-weight: bolder; " >Jobs</h3>
                                    <p class="wow fadeInLeft" data-wow-duration="1.5s">
                                        Emplore and create new job.
                                                            </p>

                                    <div class="mt-4" style="display:flex;flex-direction:row;" >

                                        <a class="btn circle btn-md btn-dark wow fadeInUp" style="border-radius: 14px;" data-wow-duration="1.8s" href="{% url 'new_task' %}" >
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16"> <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/> </svg>
                                              <span class="nav-link-text ms-1 text-uppercase">Create Job Â»</span>
                                            </a>
                                    </div>
                                  
                                </div>
                                <div class="  thumb wow fadeInRight my-4 " data-wow-duration="1s" style="width:20%;">
                                   <img width="100%" height="168"  src="{% static 'assets/img/illustration/2.png' %}" alt="Thumb">
                                </div>

<div class="main mb-4 mt-3">
  <!-- Actual search box -->
<form method="get" class="form-group has-search">
    <span class="fa fa-search form-control-feedback"></span>
    <input type="text" class="form-control" placeholder="Search Job" name="q" value={{q}} >
  </form>

<h4 class="mt-4 mb-3 text-secondary font-serif " > Your Jobs ({{ tasks|length }}) </h4>

<div class="  table-responsive">
<table cellspacing='2' cellpadding="2" class="table table-striped  table-hover table-responsive table-bordered table-sm ">
  <thead class="thead-dark bg-dark text-white ">
    <tr>
      <th>S/N</th>
      <th>Name</th>
      <th>Description</th>
      <th>Created By</th>
      <th>Date Created</th>
      <th>Status</th> 
      <th>Schedule Time</th>
      <th>Sources</th>
      <th>Transformers</th>
      <th>Targets</th>
      <th>Last Run Date</th>
      <th>Actions</th>
      <th>Workflow</th>
      <th>Logs</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
          <td>{{ forloop.counter }}. </td>
      <td>{{ task.name }}</td>
      <td>{{ task.description }}</td>
      <td>{{ task.created_by }}</td>
      <td>{{ task.date_created }}</td>

      {% if task.status == "stopped"  or not task.status  %}
  <td  > <p class="px-1 text-center " style="background-color:gray;color: white; border-radius:6px; "> {{ task.status }} </p></td>
      {% endif %}

            {% if task.status == "running"  %}
  <td  > <p class="px-1  text-center" style="background-color:green;color: white; border-radius:6px; "> {{ task.status }} </p></td>
      {% endif %}



        {% if task.status == "paused"  %}
  <td  > <p class="px-1  text-center" style="background-color:blue;color: white; border-radius:6px; "> {{ task.status }} </p></td>
      {% endif %}


        {% if task.status == "error"  %}
  <td  > <p class="px-1  text-center" style="background-color:red;color: white; border-radius:6px; "> {{ task.status }} </p></td>
      {% endif %}



                {% if task.schedule_time == "now"  %}
         <td> Run Once</td>
      {% endif %}


                {% if task.schedule_time == "hourly"  %}
         <td>{{ task.minute_time }} : minutes</td>
      {% endif %}

       {% if task.schedule_time == "daily"  %}
       <td>{{ task.daily_time }} : {{task.schedule_time}} </td>

      {% endif %}

       {% if task.schedule_time == "weekly"  %}
      
      <td>{{ task.weekly_day }} : {{ task.weekly_time }} : {{task.schedule_time}}</td>
      {% endif %}

      <td> {{ task.get_sources }}</td>
      <td> {{ task.get_transformers }}</td>
      <td> {{ task.get_targets }}</td>
      <td> {{ task.last_run_date }}:{{ task.last_run_time }}</td>
      <td>


            {% if not task.status == "running"  %}


             {% if task.status == "paused"  %}

         <a href="/customer/task-cri?task_pk={{task.pk}}&action=resume" class="" style="margin-bottom:0;">

            <svg fill="#2196f3" width="30px" height="30px" style="margin-right: 6px; margin-left: 6px;" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>play</title> <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path> </g></svg>

</a>  

{% else %}

   <a href="/customer/task-cri?task_pk={{task.pk}}&action=play" class="" style="margin-bottom:0;">

            <svg fill="#1ec258" width="30px" height="30px" style="margin-right: 6px; margin-left: 6px;" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>play</title> <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path> </g></svg>

</a>

{% endif %}


{% else %}

 <a href="/customer/task-cri?task_pk={{task.pk}}&action=pause" class="" style="margin-bottom:0;">

          <svg width="24px" height="20px" style="margin-right: 8px; margin-left: 6px;"  viewBox="-1 0 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>pause [#1006]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-227.000000, -3765.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M172,3605 C171.448,3605 171,3605.448 171,3606 L171,3612 C171,3612.552 171.448,3613 172,3613 C172.552,3613 173,3612.552 173,3612 L173,3606 C173,3605.448 172.552,3605 172,3605 M177,3606 L177,3612 C177,3612.552 176.552,3613 176,3613 C175.448,3613 175,3612.552 175,3612 L175,3606 C175,3605.448 175.448,3605 176,3605 C176.552,3605 177,3605.448 177,3606" id="pause-[#1006]"> </path> </g> </g> </g> </g></svg>

</a>

{% endif %}


  {% if not task.status == "stopped" and not task.status == 'error'  %}


           <a href="/customer/task-cri?task_pk={{task.pk}}&action=stop" class="" style="margin-bottom:0;">
<svg fill="#b31e1e" height="22px" width="22px" version="1.1" id="Capa_1" style="margin-right: 6px;"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 297 297" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M148.5,0C66.486,0,0,66.486,0,148.5S66.486,297,148.5,297S297,230.514,297,148.5S230.514,0,148.5,0z M213.292,190.121 c0,12.912-10.467,23.379-23.378,23.379H106.67c-12.911,0-23.378-10.467-23.378-23.379v-83.242c0-12.912,10.467-23.379,23.378-23.379 h83.244c12.911,0,23.378,10.467,23.378,23.379V190.121z"></path> </g></svg>
</a>

{% else %}



           <a disabled class="" style="margin-bottom:0;">
<svg fill="silver" height="22px" width="22px" version="1.1" id="Capa_1" style="margin-right: 6px;"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 297 297" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M148.5,0C66.486,0,0,66.486,0,148.5S66.486,297,148.5,297S297,230.514,297,148.5S230.514,0,148.5,0z M213.292,190.121 c0,12.912-10.467,23.379-23.378,23.379H106.67c-12.911,0-23.378-10.467-23.378-23.379v-83.242c0-12.912,10.467-23.379,23.378-23.379 h83.244c12.911,0,23.378,10.467,23.378,23.379V190.121z"></path> </g></svg>
</a>

{% endif %}
              
        <a href="/customer/task-cri?task_pk={{task.pk}}" class="" style="margin-bottom:0;">
<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg"  style="margin-right: 6px;"  viewBox="0 0 30 30" width="25px" height="25px">    <path d="M 22.828125 3 C 22.316375 3 21.804562 3.1954375 21.414062 3.5859375 L 19 6 L 24 11 L 26.414062 8.5859375 C 27.195062 7.8049375 27.195062 6.5388125 26.414062 5.7578125 L 24.242188 3.5859375 C 23.851688 3.1954375 23.339875 3 22.828125 3 z M 17 8 L 5.2597656 19.740234 C 5.2597656 19.740234 6.1775313 19.658 6.5195312 20 C 6.8615312 20.342 6.58 22.58 7 23 C 7.42 23.42 9.6438906 23.124359 9.9628906 23.443359 C 10.281891 23.762359 10.259766 24.740234 10.259766 24.740234 L 22 13 L 17 8 z M 4 23 L 3.0566406 25.671875 A 1 1 0 0 0 3 26 A 1 1 0 0 0 4 27 A 1 1 0 0 0 4.328125 26.943359 A 1 1 0 0 0 4.3378906 26.939453 L 4.3632812 26.931641 A 1 1 0 0 0 4.3691406 26.927734 L 7 26 L 5.5 24.5 L 4 23 z"/></svg>


</a>
        <a a_var="{{task.pk}}" class="delete" data-bs-toggle="modal" data-bs-target="#exampleModal" >
<svg xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;"   xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256" width="25px" height="25px" fill-rule="nonzero"><g fill="red" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(8.53333,8.53333)"><path d="M13,3c-0.26757,-0.00363 -0.52543,0.10012 -0.71593,0.28805c-0.1905,0.18793 -0.29774,0.44436 -0.29774,0.71195h-5.98633c-0.36064,-0.0051 -0.69608,0.18438 -0.87789,0.49587c-0.18181,0.3115 -0.18181,0.69676 0,1.00825c0.18181,0.3115 0.51725,0.50097 0.87789,0.49587h18c0.36064,0.0051 0.69608,-0.18438 0.87789,-0.49587c0.18181,-0.3115 0.18181,-0.69676 0,-1.00825c-0.18181,-0.3115 -0.51725,-0.50097 -0.87789,-0.49587h-5.98633c0,-0.26759 -0.10724,-0.52403 -0.29774,-0.71195c-0.1905,-0.18793 -0.44836,-0.29168 -0.71593,-0.28805zM6,8v16c0,1.105 0.895,2 2,2h14c1.105,0 2,-0.895 2,-2v-16z"></path></g></g></svg>


        </a>
      </td>

      <td> 
     <a href="" class=" btn btn-outline-primary btn-sm" 
     style="margin-bottom:0; text-transform: capitalize ;">View</a>
      </td>  

       <td> 
     <a href="" class="btn btn-outline-dark btn-sm" 
     style="margin-bottom:0; text-transform: capitalize; color:black;">Show</a>
      </td>
    </tr>
   {% empty %}
        <tr>
            <td colspan="6">No tasks found.</td>
        </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% if tasks.has_other_pages %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if tasks.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ tasks.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
            {% endif %}
            {% for i in tasks.paginator.page_range %}
                {% if tasks.number == i %}
                    <li class="page-item active"><a class="page-link" href="#">{{ i }} <span class="sr-only">(current)</span></a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                {% endif %}
            {% endfor %}
            {% if tasks.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ tasks.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endif %}

</div>



                        </div>  
                    </div>
                </div>
            </div>
        </div>
    </div>
<div>


          
          
        </div>
      </div>
    </div>


     <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form>
        <div class="modal-header   " style="background-color:#333;" >
          <h5 class="modal-title text-white " id="exampleModalLabel">Confirmation</h5>
          <button type="button" class="btn-close btn-danger " data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-danger text-center ">
              
Do you want to delete this task ?

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">
<a id='next' href="/customer/task-cri?task_pk={{task.pk}}&action=delete" class="text-white">
Delete Task
        </a>

          </button>
        </div>
      </form>
    </div>
  </div>
</div>




    {% include "includes/footer.html" %}
    
  </div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}


<style type="text/css">
  .main {
    width: 100%; 

}
td,th {
    padding: 3px !important;  
}
th {
    padding-left: 10px !important;
    padding-right: 10px !important;
}



/* Bootstrap 4 text input with search icon */

.has-search .form-control {
    padding-left: 2.375rem;
}

.has-search .form-control-feedback {
    position: absolute;
    z-index: 2;
    display: block;
    width: 2.375rem;
    height: 2.375rem;
    line-height: 2.375rem;
    text-align: center;
    pointer-events: none;
    color: #aaa;
}
</style>


  <script>

 
 const source =  $(".delete")
 source.click(function(e){
 const task_pk = $(this).attr('a_var')


const source_url = "/customer/task-cri?task_pk="+task_pk +"&action=delete"  

$("#next").attr("href",source_url)

    })



    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
{% endblock javascripts %}

